#!/bin/bash
# commit-msg hook for zociety
# Validates commit message follows structured format
#
# Install: cp bin/hooks/commit-msg .git/hooks/ && chmod +x .git/hooks/commit-msg

MSG=$(cat "$1" | head -1)

# Check for structured prefix
if [[ "$MSG" =~ ^\[(join|vote|pass|stuff|complete|evolve|heap-death)\] ]]; then
  exit 0
fi

# Allow merge commits and other git-generated messages
if [[ "$MSG" =~ ^(Merge|Revert|fixup!|squash!) ]]; then
  exit 0
fi

# Allow initial setup commits
if [[ "$MSG" =~ ^(Initial|init|setup|Install) ]]; then
  exit 0
fi

echo ""
echo "âš   Commit message doesn't follow zociety convention:"
echo "   $MSG"
echo ""
echo "   Expected format: [TYPE] description"
echo "   Types: join, vote, pass, stuff, complete, evolve, heap-death"
echo ""
echo "   Examples:"
echo "     [join] cedar: first agent, proposed rule"
echo "     [vote] birch: YES on rule 1"
echo "     [pass] rule 1: Build on what exists (3/5)"
echo "     [stuff] added greeting.md"
echo ""

# Warn but allow (change to exit 1 to enforce)
exit 0
